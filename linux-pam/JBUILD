name="linux-pam"
version="1.7.1"
url="https://github.com/linux-pam/linux-pam/releases/download/v$version/Linux-PAM-$version.tar.xz"
md5="92812d7dd414d816fba8d649e84e68ca"

build() {
    mkdir build &&
    cd    build &&

    meson setup ..        \
      --prefix=/usr       \
      --buildtype=release \
      -D docdir=/usr/share/doc/Linux-PAM-1.7.1 &&

    ninja
}

package() {
    install -v -m755 -d $DESTDIR/etc/pam.d &&

    cat > $DESTDIR/etc/pam.d/other << "EOF"
auth     required       pam_deny.so
account  required       pam_deny.so
password required       pam_deny.so
session  required       pam_deny.so
EOF

    rm -fv $DESTDIR/etc/pam.d/other

    DESTDIR=$DESTDIR ninja install &&
    chmod -v 4755 $DESTDIR/usr/sbin/unix_chkpwd

    cat > $DESTDIR/etc/pam.d/system-account << "EOF" &&
# Begin /etc/pam.d/system-account

account   required    pam_unix.so

# End /etc/pam.d/system-account
EOF

    cat > $DESTDIR/etc/pam.d/system-auth << "EOF" &&
# Begin /etc/pam.d/system-auth

auth      required    pam_unix.so

# End /etc/pam.d/system-auth
EOF

    cat > $DESTDIR/etc/pam.d/system-session << "EOF" &&
# Begin /etc/pam.d/system-session

session   required    pam_unix.so

# End /etc/pam.d/system-session
EOF

    cat > $DESTDIR/etc/pam.d/system-password << "EOF"
# Begin /etc/pam.d/system-password

# use yescrypt hash for encryption, use shadow, and try to use any
# previously defined authentication token (chosen password) set by any
# prior module.
password  required    pam_unix.so       yescrypt shadow try_first_pass

# End /etc/pam.d/system-password
EOF
}
